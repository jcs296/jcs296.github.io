<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-02-21">

<title>John Snell - How to be a modern scientist</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../img/John_Snell.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta name="twitter:title" content="John Snell - How to be a modern scientist">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="modsci.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../img/John_Snell.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">John Snell</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../projects/index.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Publications/index.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv/index.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:jcs296@case.edu"> <i class="bi bi-envelope" role="img" aria-label="email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.researchgate.net/profile/John-Snell-4"> <i class="bi bi-r-square-fill" role="img" aria-label="ResearchGate">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#paper-writing" id="toc-paper-writing" class="nav-link active" data-scroll-target="#paper-writing">Paper Writing</a></li>
  <li><a href="#publishing" id="toc-publishing" class="nav-link" data-scroll-target="#publishing">Publishing</a></li>
  <li><a href="#peer-review" id="toc-peer-review" class="nav-link" data-scroll-target="#peer-review">Peer Review</a></li>
  <li><a href="#data-sharing" id="toc-data-sharing" class="nav-link" data-scroll-target="#data-sharing">Data Sharing</a></li>
  <li><a href="#scientific-blogging" id="toc-scientific-blogging" class="nav-link" data-scroll-target="#scientific-blogging">Scientific Blogging</a></li>
  <li><a href="#scientific-code" id="toc-scientific-code" class="nav-link" data-scroll-target="#scientific-code">Scientific Code</a></li>
  <li><a href="#social-media-in-science" id="toc-social-media-in-science" class="nav-link" data-scroll-target="#social-media-in-science">Social Media in Science</a></li>
  <li><a href="#teaching-in-science" id="toc-teaching-in-science" class="nav-link" data-scroll-target="#teaching-in-science">Teaching in Science</a></li>
  <li><a href="#books" id="toc-books" class="nav-link" data-scroll-target="#books">Books</a></li>
  <li><a href="#internal-scientific-communication" id="toc-internal-scientific-communication" class="nav-link" data-scroll-target="#internal-scientific-communication">Internal Scientific Communication</a></li>
  <li><a href="#scientific-talks" id="toc-scientific-talks" class="nav-link" data-scroll-target="#scientific-talks">Scientific Talks</a></li>
  <li><a href="#reading-scientific-papers" id="toc-reading-scientific-papers" class="nav-link" data-scroll-target="#reading-scientific-papers">Reading Scientific Papers</a></li>
  <li><a href="#credit" id="toc-credit" class="nav-link" data-scroll-target="#credit">Credit</a></li>
  <li><a href="#career-planning" id="toc-career-planning" class="nav-link" data-scroll-target="#career-planning">Career Planning</a></li>
  <li><a href="#your-online-identity" id="toc-your-online-identity" class="nav-link" data-scroll-target="#your-online-identity">Your Online Identity</a></li>
  <li><a href="#closing-thoughts" id="toc-closing-thoughts" class="nav-link" data-scroll-target="#closing-thoughts">Closing Thoughts</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">How to be a modern scientist</h1>
  <div class="quarto-categories">
    <div class="quarto-category">books</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 21, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Recently, I read through Jeffrey Leek’s book <em>How to be a modern scientist</em>. This book acts as an “opinionated guide to being a scientist using modern iternet-enabled research, teaching, publishing, and communication tools” according to Leek’s own words. In the course of his writing, Leek covers a series of major points:</p>
<ul>
<li>Paper Writing</li>
<li>Publishing</li>
<li>Peer Review</li>
<li>Data Sharing</li>
<li>Scientific Blogging</li>
<li>Scientific Code</li>
<li>Social Media in Science</li>
<li>Teaching in Science</li>
<li>Books</li>
<li>Internal Scientific Communication</li>
<li>Scientific Talks</li>
<li>Reading Scientific papers</li>
<li>Credit</li>
<li>Career Planning</li>
<li>Online Identity</li>
</ul>
<p>Here, I will provide a brief overview of my personal thoughts on each section.</p>
<section id="paper-writing" class="level1">
<h1>Paper Writing</h1>
<p>A major point that Leek makes regarding the paper writing process that I haven’t greatly considered is the use of collaborative writing software in order to minimize versioning issues. Most papers I have been involved with were primarily produced using Microsoft Word, and some more recent work has been produced involving the use of Google Docs. I personally never greatly considered the importance of versioning of documents, but especially when there are more authors, being able to version can have both important credit and information sharing ramifications, so I will pay more attention to this process. Additionally, Leek calls out <a href="https://www.overleaf.com/">Overleaf</a> and <a href="https://www.sharelatex.com/">ShareLatex</a> as useful typesetting software that allow use of LaTeX in a more Google Docs-y way. I will consider looking into these in the future, as I am planning to start exploring the use of LaTeX more in my writing over the next few years.</p>
</section>
<section id="publishing" class="level1">
<h1>Publishing</h1>
<p>Two major points stood out to me in this section. First, release prints in open access format. Second, share preprints of papers. While I wholeheartedly agree with making papers open access (accessibility of information is important in science afer all!), the point about sharing preprints can be complicated, as preprint publication functionally amounts to public commons release of papers, which can have problematic consequences in some countries and at some institutions. Ultimately, I will probabbly err on the side of talking to appropriate parties for guidance when I am in situations where preprint release may cause issues. But in general, I do agree that preprint release can be useful for the general public when it is possible.</p>
</section>
<section id="peer-review" class="level1">
<h1>Peer Review</h1>
<p>When you are asked to peer review, do it quickly, or quickly decline. When you do review, evaluate the quality of the methods and data, whether the data justify the results, and how important the claims are. I personally think that it is useful to have the guidelines of a 1 month turnaround as Leek suggests as it can be challenging to have a good understanding of good timelines without insight of more senior authors. While I have gotten to see the inside of the peer review process before, getting some clearer guidelines about the proccess are especially useful in my opinion.</p>
</section>
<section id="data-sharing" class="level1">
<h1>Data Sharing</h1>
<p>Leek argues that data should be made available when the associated paper is published. I generally agree, but with a major asterisk. While the reproducibility crisis has been harrowing for biologists especially, the problem of clinical samples can quickly become problematic. RNA seq data from a mouse should assuredly be published automatically, but results that have the potential of being traced back to a patient could be problematic for them or their families, especially if bad actors in the political, data brokerage, or health insurance realms succeed in re-identifying data. As is, data privacy is underprotected in the United States (where I am), and so clinical subjects aren’t protected from those bad actors. Until better frameworks are put in place to protect data, clinical data that has the potential of being connected back to the person should maybe be held in more cautious hands. Otherwise, Data sharing should be a priority.</p>
</section>
<section id="scientific-blogging" class="level1">
<h1>Scientific Blogging</h1>
<p>Well, I guess that is partially what I am doing now.</p>
<p>Ultimately, scientific blogging has 2 major tracts according to Leek. Either you use it to respond to criticism of your work, or you use it to raise your profile. I’d probably prefer to use it to raise my profile, but we will see. Being able to put a face to a name in science is important, as the list of authors on a paper isn’t just a group of robots, and so blogging helps to personalize the people behind those papers.</p>
</section>
<section id="scientific-code" class="level1">
<h1>Scientific Code</h1>
<p>Distribute your code publicly and freely. While Leek gets into the importance of simple code and literate programming, the biggest point is to make code behind analysis freely available. A point that I think should have been made more prominently was to also make code more readable to less code-literate individuals. While this is changing, even during my undergrad education (2016-2020) we never touched code, and I’ve heard that even many recent Ph.D.s don’t get training in how to read and use code. If they need to read your code, they wouldn’t be able to read it. This also maybe gets at issues with some coding languages being obtuse to understand, but an important part of scientific code reproducability is that people with minimal training should be able to relatively quickly figure out what a chunk of code does.</p>
</section>
<section id="social-media-in-science" class="level1">
<h1>Social Media in Science</h1>
<p>I don’t think that this section aged very well. Leek argues for use of social media for networking and for communication of work, and to avoid hot button topics. The problem I take with this is that major changes have happened in the world of social media since 2016. Twitter was bought by Elon Musk and has seen a mass exodus. Regulatory changes internationally have had numerous impacts on the algorithms of social media. COVID19 made scientists the cultural firestorm for 3 years. While I do think that scientists have their place in social media, I think that the space is not as healthy as it was 8 years ago. Hopefully this improves, however.</p>
</section>
<section id="teaching-in-science" class="level1">
<h1>Teaching in Science</h1>
<p>Leek argues that teaching materials should be put online, and that materials should be tailored to modern learning approaches, such as more digestible formats. I tend to agree with Leek about the need to have online, easily accessible teaching materials in science. The need for short format teaching is sadly connected to the dopamine hacking that occurs in the modern internet, which is an issue that should be addressed, but since that is the paradigm, we must work within that framework as is possible. I do wonder personally how much space there is to develop scientific learning materials in short format media (i.e.&nbsp;TikTok/Youtube Shorts), but since I avoid interacting with the hub of those as much as possible, I am not sure personally.</p>
</section>
<section id="books" class="level1">
<h1>Books</h1>
<p>Many scientists write books. Leek argues that to avoid traditional publishers. Seems reasonable to me, especially if you are writing a smaller book like this. I don’t really have any other thoughts. Publish books if you want, have a blast, write in all the jokes. (But seriously, it’s ok to make sure that books have personality in them.)</p>
</section>
<section id="internal-scientific-communication" class="level1">
<h1>Internal Scientific Communication</h1>
<p>Have an electronic means of communicating with your team. Leek calls out <a href="https://slack.com/">Slack</a> and Hipchat (which was deprecated). I’ve heard that some groups use <a href="https://discord.com/">Discord</a>, but I’m not sure if I would recommend Discord for data privacy reasons. Big points to consider are:</p>
<ul>
<li>Possibility of setting up sub discussions per project</li>
<li>Integration/access to Google Docs etc.</li>
<li>Archived conversations</li>
</ul>
<p>While email is useful, the collaborative ability of more forum-like private messaging networks makes them more useful in the modern scientific process. Our group uses Slack, and I would definitely recommend that any lab that doesn’t use any of these kinds of networks quickly get to using them.</p>
</section>
<section id="scientific-talks" class="level1">
<h1>Scientific Talks</h1>
<p>Leek makes a number of points about scientific talks, which all culminate around the idea that a talk should be entertaining, short, and clear. These points are broadly applicable to any sort of public speaking, and I think that the section should have really been titled public speaking instead. My big add on that Leek doesn’t address is that you need to speak <strong>to</strong> your audience. It’s easy to write up a set of slides and read off of lecture notes, but if the audience members feel like you aren’t aware of them, they will wonder why this wasn’t just a recorded video. My personal approach is to not include speaker notes in a slide deck, and to avoid using note cards. Maybe this comes from the background of my father being a pastor, but a major point that I have learned is that in public speaking, you need to take people on a journey with you. Make eye contact. Gesticulate. Crack jokes. Be personable. A bad single slide presented by a great presentor is better than a great slide deck with a terrible presentor. Learn to speak <strong>to people</strong>, not <strong>at people</strong> while you are <strong>in front of people</strong>.</p>
</section>
<section id="reading-scientific-papers" class="level1">
<h1>Reading Scientific Papers</h1>
<p>There are allegedly <a href="https://wordsrated.com/number-of-academic-papers-published-per-year/">over 5 million papers published each year</a>. Assuming that it takes 1 hour to read a paper, and assuming that only 0.1% of papers are even remotely of interest to you, it would take 214.2 straight days to read those papers. Nobody has time for that. Leek proposes setting up an aggregator for papers or following bioRxiv for interesting papers. From there, read the title of every paper, read the abstracts for 20-50%, checking out the figures for 5-10%, and reading the whole paper for 1-3%. Overall, the strategy seems reasonable. One professor I had in graduate school set up a Python script that aggregates papers from Pubmed under a set of search terms, and had it set to run weekly and return links to new papers that may be of interest to him. I plan to set up some sort of aggregator myself in the near future, and will likely follow Leek’s approach to some degree.</p>
</section>
<section id="credit" class="level1">
<h1>Credit</h1>
<p>Science in the 20<sup>th</sup> and 21<sup>st</sup> centuries is built around credit. In the world of paper writing, this is having your name in the authors section. In the digital age, this involves people viewing your websites and utilizing your code. As I have less experience with the more “internety” portions of credit, the big tools that Leek calls out that I think are useful to consider are Google Analytics (page views), Publons (peer review contributions), and Google Scholar (quantifying citations to your work). It won’t be now, but I definitely plan to return to this section in the future as I continue to work on my professional profile.</p>
</section>
<section id="career-planning" class="level1">
<h1>Career Planning</h1>
<p>Have a career plan. There are many career plans out there. Broadly, I know that I am interested in following a tenure track faculty/PI researcher position. The question becomes how to follow down that road. Leek references a <a href="https://github.com/BenLangmead/langmead-lab/blob/master/postdoc_questionnaire.md">worksheet</a> which I will end up returning to at a later date. I think I will finish my quals before I dig too deep into this though.</p>
</section>
<section id="your-online-identity" class="level1">
<h1>Your Online Identity</h1>
<p>Leek adivses that a person maintain regular contact formats, and generally follow common internet courtesy. We live in an online society now, and being aware of other people and how they find and interact with you is extremely valuable both for sharing science, and for representing the institution you work at/for. Pretty stratitforward advice that I would hope most people consider.</p>
</section>
<section id="closing-thoughts" class="level1">
<h1>Closing Thoughts</h1>
<p>The book was definitely a useful quick read, but it is already starting to show its age some. An updated version for a post-pandemic world would be especially useful to help improve longevity. Otherwise, definitely worth reading for future grad students.</p>
<p>The book can be found at <a href="https://leanpub.com/modernscientist">leanpub</a> and at <a href="https://www.amazon.com/How-modern-scientist-Jeffrey-Leek-ebook/dp/B01E0EON7W">Amazon</a> in ebook format for $10 USD.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>